################################################################################
# FILESYSTEM & DISK OPERATIONS
# Purpose: Check, repair, and manage filesystems and disks
# Used for: Filesystem maintenance, corruption recovery, disk diagnostics
################################################################################

# ========== FILESYSTEM CHECK COMMANDS ==========
# Check filesystem (must be unmounted or run from recovery mode)
sudo fsck /dev/sdX

# Check ext4 filesystem without repair
sudo fsck.ext4 -n /dev/sdX

# Check and repair ext4 (with confirmation)
sudo fsck.ext4 -p /dev/sdX

# Check XFS filesystem
sudo xfs_repair /dev/sdX

# ========== BLOCK DEVICE INFORMATION ==========
# List all block devices and partitions
lsblk

# Detailed block device information
lsblk -a

# Show block device UUIDs
blkid

# Get UUID of specific device
sudo blkid /dev/sda1

# ========== DISK PARTITIONING ==========
# List disk partitions
sudo fdisk -l

# Interactive disk partition editor
sudo fdisk /dev/sdb

# Partition disk using parted (alternative)
sudo parted /dev/sdb

# Create partition table
sudo parted /dev/sdb mklabel gpt

# Create partition
sudo parted /dev/sdb mkpart primary ext4 0% 100%

# ========== WIPE/FORMAT DISK ==========
# Wipe all data from disk (DANGEROUS!)
sudo wipefs -a /dev/sdb

# Zero-fill disk with dd (very DANGEROUS - destroys all data)
sudo dd if=/dev/zero of=/dev/sdb bs=1M status=progress

# Secure erase with multiple passes (safer but slower)
sudo shred -vfz -n 3 /dev/sdb

# ========== FORMAT FILESYSTEMS ==========
# Format partition as ext4
sudo mkfs.ext4 /dev/sdb1

# Format partition as XFS
sudo mkfs.xfs /dev/sdb1

# Format with label
sudo mkfs.ext4 -L "backup" /dev/sdb1

# ========== MOUNT OPERATIONS ==========
# Mount a device
sudo mount /dev/sdb1 /mnt/backup

# Mount with specific filesystem type
sudo mount -t ext4 /dev/sdb1 /mnt/backup

# Mount read-only
sudo mount -o ro /dev/sdb1 /mnt/backup

# Unmount a device
sudo umount /mnt/backup

# Unmount forcefully
sudo umount -f /mnt/backup

# Lazy unmount (will unmount when not in use)
sudo umount -l /mnt/backup

# ========== FILESYSTEM USAGE ==========
# Show disk space usage
df -h

# Show filesystem types
df -hT

# Show disk usage per directory
du -sh /home/*

# Find largest files
find / -type f -size +100M -exec ls -lh {} \;

# Show top 10 disk consumers
du -sh /* | sort -rh | head -10

# ========== HANDY ONE-LINERS ==========
# Find YAML files in current directory
find . -name "*.yaml" -type f
# Fast recursive copy (preserve perms)
rsync -avz src/ dest/
# Create symbolic link
ln -s /path/to/target /path/to/link
# Make script executable
chmod +x script.sh

# ========== MONITORING DISK I/O ==========
# Show disk I/O statistics
iostat -x 1

# Monitor disk usage in real-time
watch df -h

# Show open files and disk usage
lsof | head -20

# Show disk usage by process
ps aux --sort=-%mem | head -10

# ========== FSTAB MANAGEMENT ==========
# View current mounts configuration
cat /etc/fstab

# Edit fstab
sudo nano /etc/fstab

# Test fstab without rebooting
sudo mount -a

# Show all mounted filesystems
mount

# ========== PERMISSIONS & OWNERSHIP ==========
# Change file permissions
chmod 755 filename

# Change directory permissions recursively
chmod -R 755 directory/

# Change ownership
chown user:group filename

# Change ownership recursively
chown -R user:group directory/

# ========== DISK ENCRYPTION ==========
# Install LUKS encryption tools
sudo apt install cryptsetup

# Create encrypted partition
sudo cryptsetup luksFormat /dev/sdb1

# Open encrypted partition
sudo cryptsetup luksOpen /dev/sdb1 backup

# Close encrypted partition
sudo cryptsetup luksClose backup

# ========== SMART DISK MONITORING ==========
# Install smartmontools
sudo apt install smartmontools

# Check disk health
sudo smartctl -a /dev/sda

# Run short self-test
sudo smartctl -t short /dev/sda

# Get test results
sudo smartctl -l selftest /dev/sda

# ========== DISK USAGE REPORTING ==========
# Generate disk usage report
du -sh * | sort -rh

# Find files modified in last 24 hours
find / -type f -mtime -1

# Find large files
find / -type f -size +1G

# Check specific directory
ls -lhS /var/lib/libvirt/images | head -20

# ========== QUOTA MANAGEMENT ==========
# Set disk quota for user
sudo setquota -u username 1000000 2000000 0 0 /

# Show user quotas
sudo quota -u username

# Generate quota report
sudo repquota /
