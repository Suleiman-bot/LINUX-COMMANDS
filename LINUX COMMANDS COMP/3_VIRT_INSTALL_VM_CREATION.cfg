################################################################################
# VIRT-INSTALL - Create and Deploy Virtual Machines
# Purpose: Install and configure KVM/QEMU virtual machines with virt-install
# Used for: VM creation, disk configuration, network setup, graphics/VNC setup
################################################################################

# ========== BASIC VM CREATION WITH EXISTING QCOW2 DISK ==========
# Create VM from existing disk image (zabbix-server example - 33GB RAM, 4 vCPU)
sudo virt-install \
  --name zabbix-server \
  --ram 33000 \
  --vcpus 4 \
  --disk path=/var/lib/libvirt/images/zabbix_appliance-7.0.4-disk001.qcow2,format=qcow2 \
  --import \
  --network bridge=virbr1 \
  --osinfo detect=on,require=off \
  --graphics vnc,port=59001,listen=0.0.0.0 \
  --noautoconsole

# ========== CREATE VM FROM STORAGE POOL ==========
# Create VM using disk from storage pool (alternative method)
sudo virt-install \
  --name server1 \
  --ram 8192 \
  --vcpus 2 \
  --disk pool=vmdata,size=50,format=qcow2 \
  --os-variant ubuntu22.04 \
  --cdrom /path/to/ubuntu-22.04.iso \
  --network network=default \
  --graphics spice \
  --noautoconsole

# ========== CREATE VM WITH CUSTOM VNC PORT ==========
# Create VM with specific VNC port (kasi-PRTG example - 8192MB RAM, 4 vCPU, port 59002)
sudo virt-install \
  --name kasi-PRTG \
  --ram 8192 \
  --vcpus 4 \
  --disk path=/var/lib/libvirt/images/kasi-PRTG.qcow2,format=qcow2 \
  --import \
  --network bridge=virbr1 \
  --osinfo detect=on,require=off \
  --graphics vnc,port=59002,listen=0.0.0.0 \
  --noautoconsole

# ========== CREATE VM WITH HIGHER RESOURCES ==========
# Create VM with 16GB RAM and 8 vCPU (kasiVidMgr example)
sudo virt-install \
  --name kasiVidMgr \
  --ram 16384 \
  --vcpus 8 \
  --disk path=/var/lib/libvirt/images/KasiVidMgr.qcow2,format=qcow2 \
  --import \
  --network bridge=virbr1 \
  --osinfo detect=on,require=off \
  --graphics vnc,port=59001,listen=0.0.0.0 \
  --noautoconsole

# ========== CREATE VM WITH CD-ROM ==========
# Create VM and attach ISO for OS installation
sudo virt-install \
  --name kasi-otobo \
  --ram 33000 \
  --vcpus 8 \
  --disk path=/var/lib/libvirt/images/kasi-otobo.qcow2,format=qcow2 \
  --import \
  --network bridge=virbr1 \
  --cdrom /var/lib/libvirt/images/ubuntu-24.04.3-live-server-amd64.iso \
  --osinfo detect=on,require=off \
  --graphics vnc,port=59003,listen=0.0.0.0 \
  --noautoconsole

# ========== CREATE IOT VM EXAMPLE ==========
# Create VM for IoT purposes (16GB RAM, 4 vCPU)
sudo virt-install \
  --name kasiIOT \
  --ram 16384 \
  --vcpus 4 \
  --disk path=/var/lib/libvirt/images/KasiIOT.qcow2,format=qcow2 \
  --import \
  --network bridge=virbr1 \
  --osinfo detect=on,require=off \
  --graphics vnc,port=59002,listen=0.0.0.0 \
  --noautoconsole

# ========== CREATE TEST SERVER VM ==========
# Create test server VM with 33GB RAM, 4 vCPU
sudo virt-install \
  --name testserver \
  --ram 33000 \
  --vcpus 4 \
  --disk path=/var/lib/libvirt/images/testServer.qcow2,format=qcow2 \
  --import \
  --network bridge=virbr1 \
  --osinfo detect=on,require=off \
  --graphics vnc,port=59003,listen=0.0.0.0 \
  --noautoconsole

# ========== CREATE KUBERNETES WORKER NODE ==========
# Create Kubernetes worker node (16GB RAM, 8 vCPU)
sudo virt-install \
  --name k8s-worker-02 \
  --ram 16384 \
  --vcpus 8 \
  --disk path=/var/lib/libvirt/images/k8s-worker-02.qcow2,format=qcow2 \
  --import \
  --network bridge=virbr1 \
  --osinfo detect=on,require=off \
  --graphics vnc,port=59007,listen=0.0.0.0 \
  --noautoconsole

# ========== CREATE GRAYLOG LOGGING VM ==========
# Create Graylog centralized logging server (32GB RAM, 4 vCPU)
sudo virt-install \
  --name Graylog \
  --ram 32768 \
  --vcpus 4 \
  --disk path=/var/lib/libvirt/images/graylog.qcow2,format=qcow2 \
  --import \
  --network bridge=virbr1 \
  --osinfo detect=on,require=off \
  --graphics vnc,port=59002,listen=0.0.0.0 \
  --noautoconsole

# ========== COMMON VIRT-INSTALL OPTIONS EXPLANATION ==========
# --name: VM hostname/identifier
# --ram: RAM in MB (8192 = 8GB, 33000 = 33GB)
# --vcpus: Number of virtual CPUs
# --disk path=/path/to/disk.qcow2,format=qcow2: Disk file location and format
# --import: Use existing disk (don't create new one)
# --network bridge=virbr1: Network bridge to connect to
# --osinfo detect=on,require=off: Detect OS and don't require exact match
# --graphics vnc,port=PORT,listen=0.0.0.0: VNC console on specific port
# --noautoconsole: Don't open console automatically after creation

# ========== VERIFY VM CREATION ==========
# List all VMs (should show newly created VM)
sudo virsh list --all

# Start the newly created VM
sudo virsh start zabbix-server

# Get IP address (if DHCP is configured)
sudo virsh domifaddr zabbix-server

# Connect via VNC (use port from graphics option above, e.g., :59001 = port 5959001)
# Use VNC client and connect to: <host-ip>:59001
